做过移动端适配的同学一定用到过这行代码：

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0">
```

从  Chrome32+ 版本开始是会默认禁用用户缩放的，但是考虑到兼容大部分设备，还是要加上其他设置，让 meta 标签能够有更好的容错性。也就是下面这段代码：

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;">
```

需要注意的是，在 ios10+以上，开发者设置了 

```
user-scalable=no
```

```
Safari
```

还是允许用户通过手势来缩放。（安卓手机的内置浏览器也逐渐开放用户缩放，即使使用 meta 标签进行设置）

解决的方法    检测 `touch`相关事件来阻止事件的触发

```html
window.onload = function() {
    // 同时按下两个手指
    document.addEventListener('touchstart', function(event) {
        if(event.touches.length > 1) {
            event.preventDefault()
        }
    })
    var lastTouchEnd = 0;
    // 特别注意300ms时差的设置
    document.addEventListener('touchend', function(event) {
        var now = (new Date()).getTime();
        if(now-lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    })
}
```



我们先来辨析一下在适配的时候经常会遇到的一些名词、数值单位

先来看一下物理像素

以iphone6为例

**分辨率**：1334pt x 750pt 指的是屏幕上垂直有1334个物理像素，水平有750个物理像素。

**屏幕尺寸**：4.7in 注意英寸是长度单位，不是面积单位。4.7英寸指的是屏幕对角线的长度，1英寸等于2.54cm。

**屏幕像素密度**：326ppi 指的是每英寸屏幕所拥有的像素数，在显示器中，dpi=ppi。dpi强调的是每英寸多少点。同时，屏幕像素密度=分辨率/屏幕尺寸

接着，我们来看一下其他的单位。

**设备独立像素**：设备独立像素，不同于设备像素（物理像素），它是虚拟化的。比如说css像素，我们常说的10px其实指的就是它。需要注意的是，物理像素开发者是无法获取的，它是自然存在的一种东西，该是多少就是多少。

**设备像素比**：缩写简称dpr，也就是我们经常在谷歌控制台移动端调试顶端会看到的一个值。设备像素比 = 设备像素 / css像素（垂直方向或水平方向）。可以通过JS来获取： `window.devicePixelRatio`



**视觉视口**

对于视觉视口来说，这个东西是呈现给用户的，它是用户看到网页区域内CSS像素的数量。由于用户可以自行进行缩放控制，所以这个视口并不是开发者需要重点关注的。

值得注意的是，在移动端缩放不会改变布局视口的宽度，当缩小的时候，屏幕覆盖的css像素变多，视觉视口变大，反之亦然。

而在PC端，缩放对应布局宽度和视觉窗口宽度都是联动的。而浏览器宽度本身是固定的，无论怎么缩放都不受影响。

##### 理想视口

布局视口完全忽略了手机本来的尺寸。

所以**苹果引入了理想视口的概念**，它是对设备来说最理想的布局视口尺寸。理想视口中的网页用户最理想的宽度，用户进入页面的时候不需要缩放。

那么很明显，所谓的理想宽度就是浏览器（屏幕）的宽度了。

所以就有了下面的这段代码：

```javascript
<meta name="viewport" content="width=device-width">
```

然而，这段代码其实也并不完美，在IE浏览器中，由于横屏竖屏的切换会对其造成影响，为了解决这个兼容性的问题，最后再加上一句，就有了现在的：

```html
<meta name="viewport" content="width=device-width,initial-scale=1">
width=device-width
```

 这句代码可以把布局视口设置成为浏览器（屏幕）的宽度。

`initial-scale=1` 的意思是初始缩放的比例是1，使用它的时候，同时也会将布局视口的尺寸设置为缩放后的尺寸。而缩放的尺寸就是基于屏幕的宽度来的，也就起到了和 `width=device-width`同样的效果。

另外，值得一提的是，我们在进行媒体查询的时候，查询的宽度值其实也是布局视口的宽度值。

#### dpr的具体表现

有时候我们会发现，当我们在适某一机型的时候，显示上没什么问题。但是一旦我换到另外一部手机，发现出现了模糊的情况，尤其图片更为显著。

其实这个问题，就是涉及到了上面讲到的一个属性：设备像素比，即我们经常说的dpr。下面先来看dpr的表现：

假设现在有一台iphone6，那么它的设备独立像素是375x667，dpr为2，尺寸是4.7in，那么物理像素就是750x1334。 同样的我们也有一台不知名的设备，它的设备独立像素刚好也是375x667，尺寸也是4.7in，但是dpr为1，此时的物理像素就是375x667。

它们的屏幕展示的区别：

在不同的屏幕上，无论是普通屏幕还是retina屏幕，css像素所呈现的大小是一致的。（如果不理解这句话，可以写一个2px的正方形使用谷歌控制台移动设备调试，在不同的设备之间来回切换，你会发现大小其实是一样的。一开始我总以为这个css像素的实际宽高因为受到dpr的影响而在不同设备上的长宽是不一致的。）

不同的是，1个css像素对应（覆盖）的物理像素个数。

所以，如果我们想要在这两个屏幕显示这么一个css样式：

```html
width: 2px;
heigth: 2px;
```

在普通屏幕下，也就是dpr为1的屏幕中，1个css像素对应（覆盖）的是一个物理像素。在retina屏幕下，1个css像素对应（覆盖）的是4个物理像素。换句话说，就是dpr为2的设备。看下面这张图：

浅显的理解就是可以看作是2cmx2cm的正方形被切割成四块，然后遇到dpr为2的时候，被切割的四块又被分别切割成四块，但是总面积不变。

#### 模糊的产生

知道了1个css像素覆盖的物理像素可能不同，就好理解为什么会出现模糊的情况了。

这里又讲到一个名词：**位图像素**。

位图像素是栅格图像（如：png,jpg,gif等）最小的数据单元。每一个位图像素都包含着一些自身的显示信息。（如：显示位置，颜色值，透明度等）

理论上来说，**1个位图像素对应1个物理像素，图片才能达到完美清晰的展示**。

但是上面说过，在retina屏幕上，会出现1个位图像素对应多个物理像素。

还是以iphone6为例，1个位图像素对应4个物理像素。由于单个位图像素已经是最小的数据单位了，它不能再被进行切割。于是为了能够显示出来，就只能就近取色，从而导致所谓的图片模糊问题。

**如何解决**

很明显，由于位图像素不够分而产生模糊的情况，解决的办法十分简单，就是使用跟dpr同个倍数大小的图片。比如iphone6，一个200x300的 `img`标签，原图就要提供400x600的大小。

那么当加载到 `img`标签中，浏览器会自动对每1px的css像素减半，可以理解为此时还是维持着1:1的css像素:物理像素，不产生模糊。

#### 微信中展示问题

在微信中展示跟在谷歌和微信开发者工具中展示的效果差别很大，微信中 iPhone 和 安卓 不同的机型手机会有虚拟键，屏幕可视窗口的高度会缩小，图片被压缩，会导致图片变形和位置偏移。

解决方法：

适配手机端的传统rem布局

假设现在要适配一个iphone6的设备

1. 设计师给了一个750px宽度的设计稿（注意这里是750px而不是375px）
2. 前端工程师用750px的这个比例开始还原
3. 把宽高是px的转换成rem
4. 字体使用px而不使用rem

#### rem布局和字体的处理

在宽高中使用的是rem，是为了保证在不同宽度尺寸的设备中能够保证布局的等比例缩放。

由于retina屏幕下dpr的不同，我们又想显示的字体一样大，于是就给字体再增大dpr的倍数，这样当缩小dpr倍的时候，那么字体也就和设计稿所示的大小一样大了，在不同的手机中显示的大小也是一致的。



#### 处理安卓手机的适配

安卓手机，dpr参数五花八门，从1到4，连1.75、2.75这种奇葩的数字也有，所以个人觉得权衡之下，直接简单“粗暴”把安卓手机全部设置为1，是效率和收益更高的做法。

### 响应式与自适应的选择

> 响应式针对的是不同分辨率设备而进行的适配式设计，以利用@media规则为主要手段，而自适应则忽略@media以比例布局为主，目的是适应不同的浏览器窗口大小。

在做不同机型是适配时，用到了媒体查询，但是媒体查询不能对每个安卓适配，因为不同机型的浏览器、微信、qq浏览器的可视区域不同，根据图片的内容添加元素，还要保持的元素的位置在每个机型里展示一样是不可能的，所以我们只能选择个别机型做适配，计算出可视窗口的高度，然后在统计出的手机可视高度之间做适配。在保证图片不变形的情况下，UI同学也要根据机型给出相应的图片。